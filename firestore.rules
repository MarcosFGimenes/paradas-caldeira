rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function hasValidString(field, max) {
      return !(field in request.resource.data) ||
        (request.resource.data[field] is string &&
          request.resource.data[field].size() > 0 &&
          request.resource.data[field].size() <= max);
    }

    function hasValidStatus() {
      return !("status" in request.resource.data) ||
        request.resource.data.status in [
          "planning",
          "in_progress",
          "completed",
          "paused"
        ];
    }

    // Leituras são públicas para permitir o compartilhamento de links sem exigir autenticação.
    match /packages/{id} {
      allow read, write: if true;
    }

    match /subpackages/{id} {
      allow read, write: if true;
    }

    match /workorders/{id} {
      allow read, write: if true;
    }

    match /workorderlogs/{id} {
      allow read, write: if true;
    }

    match /{document=**} {
      allow read, write: if true;
    }
  }
}
